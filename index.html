<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Event Staff Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #2c2f33;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .page {
            display: none;
            background: #23272a;
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            max-width: 700px;
        }

            .page.active {
                display: block;
            }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: none;
            background: #2c2f33;
            color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #7289da;
            color: white;
            cursor: pointer;
        }

            button:hover {
                background: #5b6eae;
            }

        .note {
            position: relative;
            background: #2c2f33;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #7289da;
            border-radius: 8px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 8px;
            font-size: 12px;
            border-radius: 20px;
            background: rgba(255,0,0,0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255,0,0,0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- LOGIN -->
    <div id="loginPage" class="page active">
        <h2>Login with Discord ID</h2>
        <input id="discordId" placeholder="Discord ID">
        <input id="password" type="password" placeholder="Password (1)">
        <button onclick="login()">Login</button>
        <p id="loginMsg" style="color:red;"></p>
    </div>

    <!-- MAIN -->
    <div id="mainPage" class="page">
        <h2>Welcome, <span id="userDisplay"></span></h2>

        <select id="staffName">
            <option value="" disabled selected>Select Staff</option>
            <option>Masonman585</option>
            <option>ùô∑ùöäùö£ùöñùöäùöù</option>
            <option>civda</option>
            <option>Glitch</option>
            <option>Mr.Builder</option>
            <option>Nate</option>
            <option>Riskhunter</option>
            <option>SmokeSteelz</option>
        </select>

        <textarea id="staffNote" placeholder="Write notes here"></textarea>
        <button onclick="addNote()">Save Note</button>

        <h3>Saved Notes</h3>
        <div id="notesList"></div>

        <button onclick="logout()">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQnBtnX3IeSD3PSBJz-6qzdZ1TeFdIU-Y",
            authDomain: "event-host-we.firebaseapp.com",
            projectId: "event-host-we",
            storageBucket: "event-host-we.firebasestorage.app",
            messagingSenderId: "935018089447",
            appId: "1:935018089447:web:02893483daf382c4098b42",
            measurementId: "G-5J3L06TL7E"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const allowedIds = ["1229027284346994703", "713922739748208660"];
        const passwordRequired = "1";

        window.login = async function () {
            const id = document.getElementById("discordId").value.trim();
            const pass = document.getElementById("password").value;

            if (!allowedIds.includes(id)) {
                document.getElementById("loginMsg").textContent = "ID not allowed";
                return;
            }
            if (pass !== passwordRequired) {
                document.getElementById("loginMsg").textContent = "Wrong password";
                return;
            }

            await signInAnonymously(auth);

            sessionStorage.setItem("user", id);
            document.getElementById("loginPage").classList.remove("active");
            document.getElementById("mainPage").classList.add("active");
            document.getElementById("userDisplay").textContent = id;

            loadNotes();
        }

        window.logout = function () {
            sessionStorage.clear();
            document.getElementById("mainPage").classList.remove("active");
            document.getElementById("loginPage").classList.add("active");
        }

        window.addNote = async function () {
            const staff = document.getElementById("staffName").value;
            const note = document.getElementById("staffNote").value.trim();
            const user = sessionStorage.getItem("user");

            if (!staff || !note) return alert("Fill everything");

            await addDoc(collection(db, "notes"), {
                staffName: staff,
                staffNote: note,
                by: user,
                date: Date.now()
            });

            document.getElementById("staffNote").value = "";
        }

        function loadNotes() {
            const user = sessionStorage.getItem("user");
            const q = query(collection(db, "notes"), where("by", "==", user), orderBy("date", "desc"));

            onSnapshot(q, (snapshot) => {
                const list = document.getElementById("notesList");
                list.innerHTML = "";
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    const div = document.createElement("div");
                    div.className = "note";
                    div.innerHTML = `
            <button class="delete-btn" onclick="deleteNote('${docSnap.id}')">Delete</button>
            <strong>${data.staffName}</strong>
            <div>${new Date(data.date).toLocaleString()}</div>
            <div>${data.staffNote}</div>
          `;
                    list.appendChild(div);
                });
            });
        }

        window.deleteNote = async function (id) {
            await deleteDoc(doc(db, "notes", id));
        }
    </script>

</body>
</html>
