<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Staff Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #14161a;
            --panel: rgba(255,255,255,0.06);
            --panel2: rgba(255,255,255,0.08);
            --stroke: rgba(255,255,255,0.10);
            --text: #eef1f6;
            --muted: rgba(238,241,246,0.68);
            --brand: #7289da;
            --danger: #ff6b6b;
            --shadow: 0 18px 60px rgba(0,0,0,0.45);
            --radius: 18px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter',sans-serif;
            color: var(--text);
            background: radial-gradient(1200px 600px at 20% -10%, rgba(114,137,218,0.28), transparent 60%), radial-gradient(900px 500px at 90% 10%, rgba(255,107,107,0.18), transparent 60%), radial-gradient(900px 700px at 50% 120%, rgba(114,137,218,0.18), transparent 60%), var(--bg);
            min-height: 100vh;
        }

        .glass {
            background: var(--panel);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
        }

        /* ---------- Login ---------- */
        .login-wrap {
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 24px;
        }

        .login-card {
            width: 100%;
            max-width: 560px;
            padding: 26px;
        }

        .title {
            font-size: 28px;
            margin: 0 0 6px;
            letter-spacing: 0.2px;
        }

        .subtitle {
            margin: 0 0 16px;
            color: var(--muted);
            font-size: 14px;
        }

        .stack {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        input, select, textarea {
            width: 100%;
            padding: 13px 14px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.10);
            background: rgba(0,0,0,0.20);
            color: var(--text);
            outline: none;
            font-size: 14px;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

            input::placeholder, textarea::placeholder {
                color: rgba(238,241,246,0.42);
            }

        .btn {
            width: 100%;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.10);
            cursor: pointer;
            background: rgba(0,0,0,0.20);
            color: var(--text);
            transition: 0.15s ease;
            font-weight: 600;
        }

            .btn:hover {
                transform: translateY(-1px);
                background: rgba(255,255,255,0.08);
            }

        .btn-primary {
            background: rgba(114,137,218,0.28);
            border-color: rgba(114,137,218,0.45);
        }

            .btn-primary:hover {
                background: rgba(114,137,218,0.36);
            }

        .mini {
            font-size: 12px;
            color: var(--muted);
        }

        .error {
            color: var(--danger);
            margin: 6px 0 0;
            font-size: 13px;
        }

        .quick-wrap {
            margin-top: 10px;
        }

        .quick-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .quick-btn {
            width: auto;
            padding: 8px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            color: var(--text);
            cursor: pointer;
        }

            .quick-btn:hover {
                background: rgba(255,255,255,0.10);
            }

        .link {
            display: inline-block;
            margin-top: 8px;
            font-size: 12px;
            color: var(--muted);
            text-decoration: underline;
            cursor: pointer;
        }

        /* ---------- App Shell ---------- */
        .app {
            display: none;
            min-height: 100vh;
        }

        .shell {
            display: grid;
            grid-template-columns: 270px 1fr;
            gap: 18px;
            padding: 18px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .sidebar {
            padding: 18px;
            position: sticky;
            top: 18px;
            height: calc(100vh - 36px);
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .brand {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

            .brand .name {
                font-weight: 700;
                font-size: 16px;
            }

        .pill {
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(114,137,218,0.20);
            border: 1px solid rgba(114,137,218,0.35);
            color: var(--text);
            white-space: nowrap;
        }

        .nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 6px;
        }

            .nav button {
                text-align: left;
                width: 100%;
                border-radius: 14px;
                padding: 11px 12px;
                background: rgba(255,255,255,0.04);
                border: 1px solid rgba(255,255,255,0.08);
                color: var(--text);
                cursor: pointer;
                font-weight: 600;
                transition: 0.15s ease;
            }

                .nav button:hover {
                    background: rgba(255,255,255,0.08);
                }

                .nav button.active {
                    background: rgba(114,137,218,0.22);
                    border-color: rgba(114,137,218,0.40);
                }

        .sidebar-bottom {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-danger {
            background: rgba(255,107,107,0.14);
            border-color: rgba(255,107,107,0.25);
        }

            .btn-danger:hover {
                background: rgba(255,107,107,0.20);
            }

        .content {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .topbar {
            padding: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

            .topbar h2 {
                margin: 0;
                font-size: 18px;
            }

            .topbar .muted {
                color: var(--muted);
                font-size: 13px;
                margin-top: 4px;
            }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 18px;
        }

        .tab {
            display: none;
        }

            .tab.active {
                display: block;
            }

        .controls {
            display: grid;
            grid-template-columns: 1fr 220px;
            gap: 12px;
            margin-top: 10px;
        }

        .notes {
            padding: 18px;
        }

        .note {
            position: relative;
            padding: 16px;
            border-radius: 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            margin-top: 12px;
            transition: 0.15s ease;
        }

            .note:hover {
                transform: translateY(-1px);
                background: rgba(255,255,255,0.07);
            }

        .note-title {
            font-weight: 700;
            font-size: 16px;
            margin: 0 0 6px;
        }

        .note-meta {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 10px;
        }

        .note-text {
            font-size: 14px;
            line-height: 1.45;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .delete-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: auto;
            padding: 7px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(255,107,107,0.14);
            border: 1px solid rgba(255,107,107,0.25);
            color: var(--danger);
            cursor: pointer;
        }

            .delete-btn:hover {
                background: rgba(255,107,107,0.20);
            }

        .card {
            padding: 18px;
        }

            .card h3 {
                margin: 0 0 10px;
                font-size: 16px;
            }

        .hint {
            font-size: 12px;
            color: var(--muted);
            margin-top: -4px;
        }

        /* Prompt dropdown grid */
        .prompt-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .prompt-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

            .prompt-actions .btn {
                width: 100%;
            }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 18px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.45);
            border: 1px solid rgba(255,255,255,0.10);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 999px;
            backdrop-filter: blur(10px);
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.35);
            font-size: 13px;
        }

        @media (max-width: 900px) {
            .shell {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
                height: auto;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .prompt-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <!-- LOGIN -->
    <div id="loginWrap" class="login-wrap">
        <div class="login-card glass">
            <div class="title">Event Staff Tracker</div>
            <div class="subtitle">Login with Discord ID (password is <b>1</b>)</div>

            <div id="quickLoginWrap" class="quick-wrap" style="display:none;">
                <div class="mini">Recent logins (click to autofill):</div>
                <div id="quickLoginRow" class="quick-row"></div>
                <div class="link" onclick="clearRecentLogins()">Clear recent logins</div>
            </div>

            <div class="stack">
                <input id="discordId" placeholder="Discord ID" />
                <div id="loginAs" class="mini"></div>
                <input id="password" type="password" placeholder="Password (1)" />
                <button class="btn btn-primary" onclick="login()">Login</button>
                <div id="loginMsg" class="error"></div>
                <div id="statusText" class="mini">Status: loading‚Ä¶</div>
            </div>
        </div>
    </div>

    <!-- APP -->
    <div id="app" class="app">
        <div class="shell">
            <!-- SIDEBAR -->
            <div class="sidebar glass">
                <div class="brand">
                    <div>
                        <div class="name">Dashboard</div>
                        <div class="mini">Event Staff Tracker</div>
                    </div>
                    <div class="pill" id="userPill">‚Äî</div>
                </div>

                <div class="nav">
                    <button id="tabBtnNotes" class="active" onclick="openTab('notesTab')">üóí Notes</button>
                    <button id="tabBtnAdd" onclick="openTab('addTab')">‚ûï Add Note</button>
                    <button id="tabBtnSettings" onclick="openTab('settingsTab')">‚öô Settings</button>
                </div>

                <div class="sidebar-bottom">
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                    <div class="mini">Synced with Firestore ‚úÖ</div>
                </div>
            </div>

            <!-- CONTENT -->
            <div class="content">
                <div class="topbar glass">
                    <div>
                        <h2 id="topTitle">Notes</h2>
                        <div class="muted" id="topDesc">Search and filter your notes.</div>
                    </div>
                    <div class="pill" id="topUser">‚Äî</div>
                </div>

                <div class="grid">
                    <!-- NOTES TAB -->
                    <div id="notesTab" class="tab active glass notes">
                        <div class="mini">Your notes are private to your login ID.</div>

                        <div class="controls">
                            <input id="searchInput" placeholder="Search notes‚Ä¶" />
                            <select id="filterStaff">
                                <option value="__all__">All staff</option>
                                <option>Masonman585</option>
                                <option>ùô∑ùöäùö£ùöñùöäùöù</option>
                                <option>civda</option>
                                <option>Glitch</option>
                                <option>Mr.Builder</option>
                                <option>Nate</option>
                                <option>Riskhunter</option>
                                <option>SmokeSteelz</option>
                            </select>
                        </div>

                        <div id="notesList" class="mini" style="margin-top:12px;">Loading‚Ä¶</div>
                    </div>

                    <!-- ADD TAB -->
                    <div id="addTab" class="tab glass card">
                        <h3>Add a note</h3>
                        <div class="hint">Use prompts to help write consistent notes.</div>

                        <select id="staffName">
                            <option value="" disabled selected>Select Staff</option>
                            <option>Masonman585</option>
                            <option>ùô∑ùöäùö£ùöñùöäùöù</option>
                            <option>civda</option>
                            <option>Glitch</option>
                            <option>Mr.Builder</option>
                            <option>Nate</option>
                            <option>Riskhunter</option>
                            <option>SmokeSteelz</option>
                        </select>

                        <textarea id="staffNote" placeholder="Write your notes here‚Ä¶"></textarea>

                        <!-- PROMPT DROPDOWNS -->
                        <div class="hint" style="margin-top:10px;">Quick prompts (pick some, then click ‚ÄúAdd prompts to note‚Äù)</div>
                        <div class="prompt-grid">
                            <select id="tonePick">
                                <option value="">Tone / Voice‚Ä¶</option>
                                <option>Calm / quiet</option>
                                <option>Normal</option>
                                <option>Loud / energetic</option>
                                <option>Too loud / talked over people</option>
                            </select>

                            <select id="confidencePick">
                                <option value="">Confidence‚Ä¶</option>
                                <option>Confident</option>
                                <option>A bit nervous</option>
                                <option>Unsure / needed help</option>
                                <option>Very confident</option>
                            </select>

                            <select id="hostingPick">
                                <option value="">Hosting skill‚Ä¶</option>
                                <option>Explained rules clearly</option>
                                <option>Kept players engaged</option>
                                <option>Good time management</option>
                                <option>Struggled to control group</option>
                                <option>Missed key steps</option>
                            </select>

                            <select id="behaviourPick">
                                <option value="">Behaviour‚Ä¶</option>
                                <option>Respectful</option>
                                <option>Friendly</option>
                                <option>Patient</option>
                                <option>Got frustrated</option>
                                <option>Was rude / targeted people</option>
                            </select>

                            <select id="pacingPick">
                                <option value="">Event flow‚Ä¶</option>
                                <option>Started quickly</option>
                                <option>Smooth transitions</option>
                                <option>Great pacing</option>
                                <option>Slow start</option>
                                <option>Lots of downtime</option>
                            </select>

                            <select id="ratingPick">
                                <option value="">Overall rating‚Ä¶</option>
                                <option>‚≠ê 1 (Not ready)</option>
                                <option>‚≠ê‚≠ê 2 (Needs training)</option>
                                <option>‚≠ê‚≠ê‚≠ê 3 (Okay)</option>
                                <option>‚≠ê‚≠ê‚≠ê‚≠ê 4 (Good)</option>
                                <option>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 (Excellent)</option>
                            </select>

                            <select id="recommendPick">
                                <option value="">Recommendation‚Ä¶</option>
                                <option>‚úÖ Pass</option>
                                <option>üü° Maybe / needs training</option>
                                <option>‚ùå Fail</option>
                            </select>

                            <button class="btn" type="button" onclick="applyPrompts()">Add prompts to note</button>
                        </div>

                        <div class="prompt-actions">
                            <button class="btn btn-primary" onclick="addNote()">Save Note</button>
                        </div>
                    </div>

                    <!-- SETTINGS TAB -->
                    <div id="settingsTab" class="tab glass card">
                        <h3>Settings</h3>
                        <div class="hint">Quality of life stuff.</div>
                        <button class="btn" onclick="clearRecentLogins()">Clear recent logins (this device)</button>
                        <div class="mini" style="margin-top:8px;">
                            Recent logins are saved per browser/device. Notes are stored in Firestore and sync everywhere.
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import {
            getFirestore, collection, addDoc, query, where,
            onSnapshot, deleteDoc, doc
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQnBtnX3IeSD3PSBJz-6qzdZ1TeFdIU-Y",
            authDomain: "event-host-we.firebaseapp.com",
            projectId: "event-host-we",
            storageBucket: "event-host-we.firebasestorage.app",
            messagingSenderId: "935018089447",
            appId: "1:935018089447:web:02893483daf382c4098b42",
            measurementId: "G-5J3L06TL7E"
        };

        const idToName = {
            "1229027284346994703": "Nugg",
            "713922739748208660": "ArtistRed",
            "930583720723898419": "cyberPICKABOOM",
            "698264742472581180": "Reeta-MKII"
        };

        const allowedIds = Object.keys(idToName);
        const passwordRequired = "1";

        // Recents
        const RECENT_KEY = "recentLogins";
        const MAX_RECENTS = 6;

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const statusText = document.getElementById("statusText");
        statusText.textContent = "Status: ready ‚úÖ";

        let unsubscribe = null;
        let latestNotes = [];

        // UI helpers
        function showToast(msg) {
            const t = document.getElementById("toast");
            t.textContent = msg;
            t.style.display = "block";
            clearTimeout(showToast._timer);
            showToast._timer = setTimeout(() => t.style.display = "none", 1600);
        }

        function escapeHtml(s) {
            return (s ?? "")
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll('"', "&quot;");
        }

        function setLoginAsText() {
            const id = document.getElementById("discordId").value.trim();
            const el = document.getElementById("loginAs");
            if (!id) { el.textContent = ""; return; }
            el.textContent = idToName[id] ? `Logging in as: ${idToName[id]}` : `Unknown ID`;
        }
        document.getElementById("discordId").addEventListener("input", setLoginAsText);

        // Tabs
        window.openTab = function (tabId) {
            ["notesTab", "addTab", "settingsTab"].forEach(id => {
                document.getElementById(id).classList.remove("active");
            });
            document.getElementById(tabId).classList.add("active");

            ["tabBtnNotes", "tabBtnAdd", "tabBtnSettings"].forEach(id => {
                document.getElementById(id).classList.remove("active");
            });

            const title = document.getElementById("topTitle");
            const desc = document.getElementById("topDesc");

            if (tabId === "notesTab") {
                document.getElementById("tabBtnNotes").classList.add("active");
                title.textContent = "Notes";
                desc.textContent = "Search and filter your notes.";
            } else if (tabId === "addTab") {
                document.getElementById("tabBtnAdd").classList.add("active");
                title.textContent = "Add Note";
                desc.textContent = "Write a new note for trial staff.";
            } else {
                document.getElementById("tabBtnSettings").classList.add("active");
                title.textContent = "Settings";
                desc.textContent = "Quick options for your device.";
            }
        };

        // Recent logins
        function getRecents() { return JSON.parse(localStorage.getItem(RECENT_KEY) || "[]"); }

        function addRecent(id) {
            let r = getRecents();
            r = r.filter(x => x !== id);
            r.unshift(id);
            r = r.slice(0, MAX_RECENTS);
            localStorage.setItem(RECENT_KEY, JSON.stringify(r));
            renderRecents();
        }

        function renderRecents() {
            const r = getRecents();
            const wrap = document.getElementById("quickLoginWrap");
            const row = document.getElementById("quickLoginRow");
            if (!r.length) { wrap.style.display = "none"; row.innerHTML = ""; return; }

            wrap.style.display = "block";
            row.innerHTML = "";
            r.forEach(id => {
                const b = document.createElement("button");
                b.className = "quick-btn";
                const name = idToName[id] || "Unknown";
                b.textContent = `${name} (${id})`;
                b.onclick = () => {
                    document.getElementById("discordId").value = id;
                    setLoginAsText();
                    document.getElementById("password").focus();
                };
                row.appendChild(b);
            });
        }

        window.clearRecentLogins = function () {
            localStorage.removeItem(RECENT_KEY);
            renderRecents();
            showToast("Recent logins cleared ‚úÖ");
        };

        // App show/hide
        function showApp() {
            document.getElementById("loginWrap").style.display = "none";
            document.getElementById("app").style.display = "block";
        }
        function showLogin() {
            document.getElementById("app").style.display = "none";
            document.getElementById("loginWrap").style.display = "grid";
        }

        // Listener (no index; sort in JS)
        function startListener() {
            const user = sessionStorage.getItem("user");
            if (!user) return;

            if (unsubscribe) unsubscribe();

            const q = query(collection(db, "notes"), where("by", "==", user));

            unsubscribe = onSnapshot(q, (snap) => {
                const notes = [];
                snap.forEach(docSnap => notes.push({ id: docSnap.id, ...docSnap.data() }));
                notes.sort((a, b) => (b.date || 0) - (a.date || 0));
                latestNotes = notes;
                renderNotes();
            }, (err) => {
                console.error(err);
                document.getElementById("notesList").textContent = "Error loading notes (check console).";
            });
        }

        function renderNotes() {
            const list = document.getElementById("notesList");
            const search = document.getElementById("searchInput").value.trim().toLowerCase();
            const filter = document.getElementById("filterStaff").value;

            let notes = [...latestNotes];
            if (filter !== "__all__") {
                notes = notes.filter(n => n.staffName === filter);
            }
            if (search) {
                notes = notes.filter(n =>
                    (n.staffName || "").toLowerCase().includes(search) ||
                    (n.staffNote || "").toLowerCase().includes(search) ||
                    (n.byName || "").toLowerCase().includes(search)
                );
            }

            list.innerHTML = "";
            if (!notes.length) {
                list.textContent = "No notes found.";
                return;
            }

            for (const n of notes) {
                const div = document.createElement("div");
                div.className = "note";
                div.innerHTML = `
            <button class="delete-btn" type="button" onclick="deleteNote('${n.id}')">Delete</button>
            <div class="note-title">${escapeHtml(n.staffName)}</div>
            <div class="note-meta">${new Date(n.date).toLocaleString()} ‚Ä¢ ${escapeHtml(n.byName || idToName[n.by] || n.by)}</div>
            <div class="note-text">${escapeHtml(n.staffNote)}</div>
          `;
                list.appendChild(div);
            }
        }

        document.getElementById("searchInput").addEventListener("input", renderNotes);
        document.getElementById("filterStaff").addEventListener("change", renderNotes);

        // ‚úÖ Add prompt lines into the textarea
        window.applyPrompts = function () {
            const tone = document.getElementById("tonePick").value;
            const conf = document.getElementById("confidencePick").value;
            const host = document.getElementById("hostingPick").value;
            const beh = document.getElementById("behaviourPick").value;
            const pace = document.getElementById("pacingPick").value;
            const rate = document.getElementById("ratingPick").value;
            const rec = document.getElementById("recommendPick").value;

            const parts = [];
            if (tone) parts.push(`‚Ä¢ Tone: ${tone}`);
            if (conf) parts.push(`‚Ä¢ Confidence: ${conf}`);
            if (host) parts.push(`‚Ä¢ Hosting: ${host}`);
            if (beh) parts.push(`‚Ä¢ Behaviour: ${beh}`);
            if (pace) parts.push(`‚Ä¢ Event flow: ${pace}`);
            if (rate) parts.push(`‚Ä¢ Rating: ${rate}`);
            if (rec) parts.push(`‚Ä¢ Recommendation: ${rec}`);

            if (!parts.length) return showToast("Pick prompts first");

            const box = document.getElementById("staffNote");
            const block = parts.join("\n");
            box.value = (box.value ? box.value.trimEnd() + "\n\n" : "") + block + "\n";
            showToast("Prompts added ‚úÖ");
        };

        // Handlers
        window.login = async function () {
            const id = document.getElementById("discordId").value.trim();
            const pass = document.getElementById("password").value;
            const msg = document.getElementById("loginMsg");
            msg.textContent = "";

            if (!allowedIds.includes(id)) { msg.textContent = "This Discord ID is not allowed."; return; }
            if (pass !== passwordRequired) { msg.textContent = "Wrong password."; return; }

            try {
                await signInAnonymously(auth);

                sessionStorage.setItem("user", id);

                const name = idToName[id] || id;
                document.getElementById("userPill").textContent = name;
                document.getElementById("topUser").textContent = `Logged in as ${name}`;

                addRecent(id);

                showApp();
                openTab("notesTab");
                startListener();
                showToast("Logged in ‚úÖ");
            } catch (e) {
                console.error(e);
                msg.textContent = "Firebase auth failed (open Console).";
            }
        };

        window.logout = function () {
            sessionStorage.removeItem("user");
            if (unsubscribe) unsubscribe();
            unsubscribe = null;
            latestNotes = [];
            showLogin();
            renderRecents();
            setLoginAsText();
            showToast("Logged out ‚úÖ");
        };

        window.addNote = async function () {
            const staff = document.getElementById("staffName").value;
            const note = document.getElementById("staffNote").value.trim();
            const user = sessionStorage.getItem("user");
            if (!staff || !note) return showToast("Fill staff + note first");

            try {
                await addDoc(collection(db, "notes"), {
                    staffName: staff,
                    staffNote: note,
                    by: user,
                    byName: idToName[user] || user,
                    date: Date.now()
                });
                document.getElementById("staffNote").value = "";
                openTab("notesTab");
                showToast("Saved ‚úÖ");
            } catch (e) {
                console.error(e);
                showToast("Save failed (check console)");
            }
        };

        window.deleteNote = async function (docId) {
            try {
                await deleteDoc(doc(db, "notes", docId));
                showToast("Deleted ‚úÖ");
            } catch (e) {
                console.error(e);
                showToast("Delete failed (check console)");
            }
        };

        // Init
        renderRecents();
        setLoginAsText();

        // Resume session
        if (sessionStorage.getItem("user")) {
            const id = sessionStorage.getItem("user");
            const name = idToName[id] || id;
            document.getElementById("userPill").textContent = name;
            document.getElementById("topUser").textContent = `Logged in as ${name}`;
            showApp();
            openTab("notesTab");
            startListener();
        }
    </script>
</body>
</html>
