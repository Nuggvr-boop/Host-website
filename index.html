<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Staff Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }
body {
  font-family: 'Inter', sans-serif;
  background: #2c2f33;
  color: #fff;
  margin: 0;
  padding: 24px;
  min-height: 100vh;
  display: grid;
  place-items: center;
}

.page {
  display: none;
  width: 100%;
  max-width: 650px;
  background: #23272a;
  border-radius: 12px;
  padding: 28px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}
.page.active { display: block; }

h1 { font-size: 26px; margin: 0 0 10px; }
h2 { font-size: 20px; margin: 0 0 12px; }
h3 { margin: 22px 0 10px; }

input, select, textarea {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  border: none;
  border-radius: 10px;
  background: #2c2f33;
  color: #fff;
  font-size: 14px;
  outline: none;
}
textarea { resize: vertical; min-height: 120px; }

button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border: none;
  border-radius: 10px;
  background: #7289da;
  color: #fff;
  font-size: 15px;
  cursor: pointer;
}
button:hover { background: #5b6eae; }

.note {
  position: relative;
  background: #2c2f33;
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 10px;
  border-left: 4px solid #7289da;
}

.note strong { font-size: 16px; display:block; margin-bottom: 6px; }
.note-meta { font-size: 12px; opacity: 0.75; margin-bottom: 8px; }
.note-text { font-size: 15px; line-height: 1.4; white-space: pre-wrap; }

.delete-btn {
  position: absolute;
  top: 10px;
  right: 12px;
  width: auto !important;
  padding: 6px 10px !important;
  border-radius: 999px !important;
  font-size: 12px !important;
  background: rgba(255, 107, 107, 0.14) !important;
  color: #ff6b6b !important;
  border: 1px solid rgba(255, 107, 107, 0.28) !important;
}
</style>
</head>

<body>

<div id="loginPage" class="page active">
  <h1>Event Staff Tracker</h1>
  <h2>Login with Discord ID</h2>

  <input type="text" id="discordId" placeholder="Your Discord ID">
  <input type="password" id="password" placeholder="Password (1)">
  <button onclick="login()">Login</button>

  <p id="loginMsg" style="color:#ff6b6b;"></p>
</div>

<div id="mainPage" class="page">
  <h2>Welcome, <span id="userDisplay"></span></h2>

  <h3>Add Notes for Trial Staff</h3>
  <select id="staffName">
    <option value="" disabled selected>Select Staff</option>
    <option>Masonman585</option>
    <option>ùô∑ùöäùö£ùöñùöäùöù</option>
    <option>civda</option>
    <option>Glitch</option>
    <option>Mr.Builder</option>
    <option>Nate</option>
    <option>Riskhunter</option>
    <option>SmokeSteelz</option>
  </select>

  <textarea id="staffNote" placeholder="Write your notes here"></textarea>
  <button onclick="addNote()">Save Note</button>

  <h3>Saved Notes</h3>
  <div id="notesList"></div>

  <button onclick="logout()">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc, query, where,
  onSnapshot, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDQnBtnX3IeSD3PSBJz-6qzdZ1TeFdIU-Y",
  authDomain: "event-host-we.firebaseapp.com",
  projectId: "event-host-we",
  storageBucket: "event-host-we.firebasestorage.app",
  messagingSenderId: "935018089447",
  appId: "1:935018089447:web:02893483daf382c4098b42",
  measurementId: "G-5J3L06TL7E"
};

const idToName = {
  "1229027284346994703": "Nugg",
  "713922739748208660": "ArtistRed",
  "930583720723898419": "cyberPICKABOOM",
  "698264742472581180": "Reeta-MKII"
};

const allowedIds = Object.keys(idToName);
const passwordRequired = "1";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let unsubscribe = null;

function show(pageId) {
  document.getElementById("loginPage").classList.remove("active");
  document.getElementById("mainPage").classList.remove("active");
  document.getElementById(pageId).classList.add("active");
}

window.login = async function() {
  const id = document.getElementById("discordId").value.trim();
  const pass = document.getElementById("password").value;

  if (!allowedIds.includes(id)) {
    document.getElementById("loginMsg").textContent = "ID not allowed.";
    return;
  }
  if (pass !== passwordRequired) {
    document.getElementById("loginMsg").textContent = "Wrong password.";
    return;
  }

  await signInAnonymously(auth);

  sessionStorage.setItem("user", id);
  document.getElementById("userDisplay").textContent = idToName[id] || id;

  show("mainPage");
  startListener();
};

window.logout = function() {
  sessionStorage.clear();
  if (unsubscribe) unsubscribe();
  show("loginPage");
};

window.addNote = async function() {
  const staff = document.getElementById("staffName").value;
  const note = document.getElementById("staffNote").value.trim();
  const user = sessionStorage.getItem("user");

  if (!staff || !note) return alert("Fill everything.");

  await addDoc(collection(db, "notes"), {
    staffName: staff,
    staffNote: note,
    by: user,
    byName: idToName[user],
    date: Date.now()
  });

  document.getElementById("staffNote").value = "";
};

window.deleteNote = async function(id) {
  await deleteDoc(doc(db, "notes", id));
};

function startListener() {
  const user = sessionStorage.getItem("user");

  const q = query(
    collection(db, "notes"),
    where("by", "==", user)
  );

  unsubscribe = onSnapshot(q, (snap) => {
    const list = document.getElementById("notesList");
    list.innerHTML = "";

    const notes = [];
    snap.forEach(docSnap => notes.push({ id: docSnap.id, ...docSnap.data() }));
    notes.sort((a,b) => (b.date || 0) - (a.date || 0));

    notes.forEach(n => {
      const div = document.createElement("div");
      div.className = "note";
      div.innerHTML = `
        <button class="delete-btn" onclick="deleteNote('${n.id}')">Delete</button>
        <strong>${n.staffName}</strong>
        <div class="note-meta">${new Date(n.date).toLocaleString()} ‚Ä¢ ${n.byName}</div>
        <div class="note-text">${n.staffNote}</div>
      `;
      list.appendChild(div);
    });
  });
}
</script>
</body>
</html>
